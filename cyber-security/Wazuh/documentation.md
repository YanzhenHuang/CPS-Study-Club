# Wazuh

Wazuh is a free and open source security platform that unifies XDR and SIEM capabilities. It protects workloads across on-premises, virtualized, containerized, and cloud-based environments.

## Components

### Wazuh indexer

| Index                    | Description                                                  |
| ------------------------ | ------------------------------------------------------------ |
| **wazuh**‑**alerts**     | Stores alerts generated by the [Wazuh server](https://documentation.wazuh.com/current/getting-started/components/wazuh-server.html). These are created each time an event trips a rule with a high enough priority (this threshold is configurable). |
| **wazuh**‑**archives**   | Stores all events (archive data) received by the [Wazuh server](https://documentation.wazuh.com/current/getting-started/components/wazuh-server.html), whether or not they trip a rule. |
| **wazuh**‑**monitoring** | Stores data related to the [Wazuh agent](https://documentation.wazuh.com/current/getting-started/components/wazuh-agent.html) status over time. It is used by the web interface to represent when individual agents are or have been `Active`, `Disconnected`, or `Never connected`. |
| **wazuh**‑**statistics** | Stores data related to the [Wazuh server](https://documentation.wazuh.com/current/getting-started/components/wazuh-server.html) performance. It is used by the web interface to represent the performance statistics. |

*You can interact with the Wazuh indexer cluster using the Wazuh indexer REST API, which offers a lot of flexibility.*



### Wazuh server

The Wazuh server component analyzes the data received from the [agents](https://documentation.wazuh.com/current/getting-started/components/wazuh-agent.html), triggering **alerts** when threats or anomalies are detected. . It also enriches alert data by using the [MITRE ATT&CK](https://attack.mitre.org//) framework and regulatory compliance requirements such as PCI DSS, GDPR, HIPAA, CIS, and NIST 800-53.

The Wazuh server can be integrated with external software, including ticketing systems such as [ServiceNow](https://www.servicenow.com/), [Jira](https://www.atlassian.com/software/jira), and [PagerDuty](https://www.pagerduty.com/), as well as instant messaging platforms like [Slack](https://slack.com//).

The server is installed on a Linux operating system and usually runs on a stand-alone physical machine, virtual machine, docker container, or cloud instance.

- **Agent enrollment service:** It is used to enroll new agents. 
- **Agent connection service:** This service receives data from the agents.
- **Analysis engine:** This is the server component that performs the data analysis.
- **Wazuh RESTful API:** This service provides an interface to interact with the Wazuh infrastructure.
- **Wazuh cluster daemon:** This service is used to scale Wazuh servers horizontally, deploying them as a cluster. 
- **Filebeat:** It is used to send events and alerts to the Wazuh indexer.



### Wazuh dashboard

The Wazuh dashboard is a flexible and intuitive web user interface for mining, analyzing, and visualizing security events and alerts data.

- Data visualization and analysis
- Agents monitoring and configuration
- Platform management
- Developer tools (e.g. Wazuh API)



### Wazuh agent

The Wazuh agent runs on Linux, Windows, macOS, Solaris, AIX, and other operating systems. It can be deployed to laptops, desktops, servers, cloud instances, containers, or virtual machines.

- **Log collector:** This agent component can read flat log files and Windows events, collecting operating system and application log messages.
- **Command execution:** Agents run authorized commands periodically, collecting their output and reporting it back to the Wazuh server for further analysis.
- **File integrity monitoring (FIM):** This module monitors the file system, reporting when files are created, deleted, or modified. 
- **Security configuration assessment (SCA):** This component provides continuous configuration assessment, utilizing out-of-the-box checks based on the Center of Internet Security (CIS) benchmarks.
- **System inventory:** This agent module periodically runs scans, collecting inventory data such as operating system version, network interfaces, running processes, installed applications, and a list of open ports.
- **Malware detection:** Using a non-signature-based approach, this component is capable of detecting anomalies and the possible presence of rootkits.
- **Active response:** This module runs automatic actions when threats are detected, triggering responses to block a network connection, stop a running process, or delete a malicious file.
- **Container security monitoring:** This agent module is integrated with the Docker Engine API to monitor changes in a containerized environment.
- **Cloud security monitoring:** This component monitors cloud providers such as Amazon AWS, Microsoft Azure, or Google GCP. It natively communicates with their APIs.

The Wazuh agent communicates with the [Wazuh server](https://documentation.wazuh.com/current/getting-started/components/wazuh-server.html) to ship collected data and security-related events. Besides, the agent sends operational data, reporting its configuration and status. Once connected, the agent can be upgraded, monitored, and configured remotely from the Wazuh server.

The communication of the agent with the server takes place through a secure channel (TCP or UDP), providing data encryption and compression in real time.



## Architecture

![](https://documentation.wazuh.com/current/_images/deployment1.png)

- The file `/var/ossec/logs/archives/archives.json` contains all events whether they tripped a rule or not.
- The file `/var/ossec/logs/alerts/alerts.json` contains only events that tripped a rule with high enough priority (the threshold is configurable).

### Required ports

Several services are used for the communication of Wazuh components. Below is the list of default ports used by these services. Users can modify these port numbers when necessary.

| Component       | Port           | Protocol                                       | Purpose                   |
| --------------- | -------------- | ---------------------------------------------- | ------------------------- |
| Wazuh server    | 1514           | TCP (default)                                  | Agent connection service  |
| 1514            | UDP (optional) | Agent connection service (disabled by default) |                           |
| 1515            | TCP            | Agent enrollment service                       |                           |
| 1516            | TCP            | Wazuh cluster daemon                           |                           |
| 514             | UDP (default)  | Wazuh Syslog collector (disabled by default)   |                           |
| 514             | TCP (optional) | Wazuh Syslog collector (disabled by default)   |                           |
| 55000           | TCP            | Wazuh server RESTful API                       |                           |
| Wazuh indexer   | 9200           | TCP                                            | Wazuh indexer RESTful API |
| 9300-9400       | TCP            | Wazuh indexer cluster communication            |                           |
| Wazuh dashboard | 443            | TCP                                            | Wazuh web user interface  |



## Log data collection

### How it works

![](https://documentation.wazuh.com/current/_images/log-analysis-flow1.png)

Wazuh can monitor classic Windows event logs, as well as the newer Windows event channels.

**Config in the wazuh-agent ui, view config `ossec.conf` file**

- Event log:

  ```
  <localfile>
    <location>Security</location>
    <log_format>eventlog</log_format>
  </localfile>
  ```

- Event channel:

  ```
  <localfile>
    <location>Microsoft-Windows-PrintService/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>
  ```



### Analysis

#### Pre-decoding

In the pre-decoding phase of analysis, static information from well-known fields is extracted from the log header.

```
Feb 14 12:19:04 localhost sshd[25474]: Accepted password for rromero from 192.168.1.133 port 49765 ssh2
```

Extracted information:

> - *hostname*: 'localhost'
> - *program_name*: 'sshd'



#### Decoding

In the decoding phase, the log message is evaluated to identify what type of log it is and known fields for that specific log type are then extracted.

Sample log and its extracted info:

```
Feb 14 12:19:04 localhost sshd[25474]: Accepted password for rromero from 192.168.1.133 port 49765 ssh2
```

Extracted information:

> - *program name*: sshd
> - *dstuser*: rromero
> - *srcip*: 192.168.1.133



#### Rule matching

In the next phase, the extracted log information is compared to the ruleset to look for matches:

For the previous example, rule 5715 is matched:

```
<rule id="5715" level="3">
  <if_sid>5700</if_sid>
  <match>^Accepted|authenticated.$</match>
  <description>sshd: authentication success.</description>
  <group>authentication_success,pci_dss_10.2.5,</group>
</rule>
```

> For more information, see the [Wazuh Ruleset](https://documentation.wazuh.com/current/user-manual/ruleset/index.html)



#### Alert

Once a rule is matched, the manager will create an alert as below:

```
** Alert 1487103546.21448: - syslog,sshd,authentication_success,pci_dss_10.2.5,
2017 Feb 14 12:19:06 localhost->/var/log/secure
Rule: 5715 (level 3) -> 'sshd: authentication success.'
Src IP: 192.168.1.133
User: rromero
Feb 14 12:19:04 localhost sshd[25474]: Accepted password for rromero from 192.168.1.133 port 49765 ssh2
```

By default, alerts will be generated on events that are important or of security relevance. To store all events even if they do not match a rule, enable the `<logall>` option.

Alerts will be stored at `/var/ossec/logs/alerts/alerts.(json|log)` and events at `/var/ossec/logs/archives/archives.(json|log)`.



### How to collect Windows logs

Windows events can be gathered and forwarded to the manager, where they are processed and alerted if they match any rule. There are two formats to collect Windows logs:

- Eventlog (supported by every Windows version)
- Eventchannel (for Windows Vista and later versions)

They are collected and shown at the **Event Viewer**, where they are classified by the source that generated them.

This information is gathered by the Windows agent, including the event description, the `system` standard fields and the specific `eventdata` information from the event. Once an event is sent to the manager, it is processed and translated to **JSON format**, which leads to an easier way of querying and filtering the event fields.

```xml
  <localfile>
    <location>Application</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <localfile>
    <location>Security</location>
    <log_format>eventchannel</log_format>
    <query>Event/System[EventID != 5145 and EventID != 5156 and EventID != 5447 and
      EventID != 4656 and EventID != 4658 and EventID != 4663 and EventID != 4660 and
      EventID != 4670 and EventID != 4690 and EventID != 4703 and EventID != 4907 and
      EventID != 5152 and EventID != 5157]</query>
  </localfile>

  <localfile>
    <location>System</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <localfile>
    <location>active-response\active-responses.log</location>
    <log_format>syslog</log_format>
  </localfile>
```

The Windows Logs of the event viewer: **Application, Security, System** is collected



### Available channels and providers

The table below shows available channels and providers to monitor included in the Wazuh ruleset:

| Source                        | Channel location                                             | Provider name                      | Description                                                  |
| ----------------------------- | ------------------------------------------------------------ | ---------------------------------- | ------------------------------------------------------------ |
| Application                   | Application                                                  | Any                                | This log retrieves every event related to system applications management and is one of the main Windows administrative channels along with Security, and System. |
| Security                      | Security                                                     | Any                                | This channel gathers information related to users and groups creation, login, logoff, and audit policy modifications. |
| System                        | System                                                       | Any                                | The System channel collects events associated with kernel and service control. |
| Sysmon                        | Microsoft-Windows-Sysmon/Operational                         | Microsoft-Windows-Sysmon           | Sysmon monitors system activity as process creation and termination, network connection and file changes. |
| Windows Defender              | Microsoft-Windows-Windows Defender/Operational               | Microsoft-Windows-Windows Defender | The Windows Defender log file shows information about the scans passed, malware detection, and actions taken against them. |
| McAfee                        | Application                                                  | McLogEvent                         | This source shows McAfee scan results, virus detection, and actions taken against them. |
| EventLog                      | System                                                       | Eventlog                           | This source retrieves information about audit and Windows logs. |
| Microsoft Security Essentials | System                                                       | Microsoft Antimalware              | This software gives information about real-time protection for the system, malware-detection scans, and antivirus settings. |
| Remote Access                 | File Replication Service                                     | Any                                | Other channels (they are grouped in a generic Windows rule file). |
| Terminal Services             | Service Microsoft-Windows-TerminalServices-RemoteConnectionManager |                                    |                                                              |

**System, Security, and Application** have their own file now and include a fair set of rules, every file has its **rule ID** range to get it organized. There are a hundred IDs set for the base rules and five hundred for each channel file.

Eventchannel for Wazuh >= 3.9.0

| Source                        | Rule IDs      | Rule file                      |
| ----------------------------- | ------------- | ------------------------------ |
| Base rules                    | 60000 - 60099 | 0575-win-base_rules.xml        |
| Security                      | 60100 - 60599 | 0580-win-security_rules.xml    |
| Application                   | 60600 - 61099 | 0585-win-application_rules.xml |
| System                        | 61100 - 61599 | 0590-win-system_rules.xml      |
| Sysmon                        | 61600 - 62099 | 0595-win-sysmon_rules.xml      |
| Windows Defender              | 62100 - 62599 | 0600-win-wdefender_rules.xml   |
| McAfee                        | 62600 - 63099 | 0605-win-mcafee_rules.xml      |
| Eventlog                      | 63100 - 63599 | 0610-win-ms_logs_rules.xml     |
| Microsoft Security Essentials | 63600 - 64099 | 0615-win-ms-se_rules.xml       |
| Others                        | 64100 - 64599 | 0620-win-generic_rules.xml     |



### Use case

Configuration file should include the next localfile block:

```xml
<localfile>
  <location>Application</location>
  <log_format>eventchannel</log_format>
</localfile>
```

The next step is to install a new application. Once it is installed, the Wazuh manager will build the next JSON event related to the installation process:

```json
{
    "win": {
        "system": {
        "providerName": "MsiInstaller",
        "eventID": "11707",
        "level": "4",
        "task": "0",
        "keywords": "0x80000000000000",
        "systemTime": "2019-04-03T10:47:39.000000000Z",
        "eventRecordID": "12615",
        "channel": "Application",
        "computer": "pcname",
        "severityValue": "INFORMATION",
        "message": "Product: Dr. Memory -- Installation completed successfully."
        },
        "eventdata": {
        "binary": "7B36373637354144362D314642302D344445312D394543462D3834393937353135303235457D",
        "data": "Product: Dr. Memory -- Installation completed successfully."
        }
    }
}
```

This event can be filtered field by field in case an alert is desired to trigger when it occurs. In this use case, the filters used will be the provider name and the event ID, as follows:

```xml
<rule id="60612" level="3">
    <field name="win.system.providerName">MsiInstaller</field>
    <field name="win.system.eventID">^11707$|^1033$</field>
    <options>alert_by_email</options>
    <description>Application Installed $(win.eventdata.data)</description>
    <options>no_full_log</options>
</rule>
```

Finally, once the event is generated, the rule from above will be matched and, therefore, trigger the next alert shown on the Wazuh dashboard:

![img](https://documentation.wazuh.com/current/_images/kibana-eventchannel-alert1.png)

### Filtering events from Windows Event Channel with queries

Events from the Windows Event channel can be filtered as below. Only events whose levels are less or equal to “3” are checked in this example.

```xml
<localfile>
  <location>System</location>
  <log_format>eventchannel</log_format>
  <query>Event/System[EventID=7040]</query>
</localfile>
```

Users can filter events with different severity levels.

```xml
<localfile>
    <location>System</location>
    <log_format>eventchannel</log_format>
    <query>
        \<QueryList\>
            \<Query Id="0" Path="System"\>
                \<Select Path="System"\>*[System[(Level&lt;=3)]]\</Select\>
            \</Query\>
        \</QueryList\>
    </query>
</localfile>
```



## Configuration

Log data collection is configured in the [ossec.conf](https://documentation.wazuh.com/current/user-manual/reference/ossec-conf/index.html#reference-ossec-conf) file primarily in the [localfile](https://documentation.wazuh.com/current/user-manual/reference/ossec-conf/localfile.html#reference-ossec-localfile), [remote](https://documentation.wazuh.com/current/user-manual/reference/ossec-conf/remote.html#reference-ossec-remote) and [global](https://documentation.wazuh.com/current/user-manual/reference/ossec-conf/global.html) sections.

Configuration of log data collection can also be completed in the [agent.conf](https://documentation.wazuh.com/current/user-manual/reference/centralized-configuration.html#reference-agent-conf) file to centralize the distribution of these configuration settings to relevant agents.

As in this basic usage example, provide the name of the file to be monitored and the format:

```xml
<localfile>
  <location>/var/log/messages</location>
  <log_format>syslog</log_format>
</localfile>
```

Wazuh can read log messages from text log files, Windows event logs, event channels, and via remote syslog. Logs are monitored in real time. Wazuh has the capability to receive and process logs from devices (firewall, VPN, and authentication) that send logs using the **syslog** protocol. You can create custom decoders and rules for your device-specific logs.



## Ruleset

https://documentation.wazuh.com/current/user-manual/ruleset/index.html

Currently, Wazuh supports more than 3k rules that accomplish technologies such:

- Syslog
- Docker
- CISCO
- SonicWall
- Sendmail
- Postfix
- Spamd
- Imapd
- MailScanner
- Microsoft Exchange
- Courier
- PIX
- NetScreen technologies
- McAfee
- NextCloud
- PaloAlto v9.0
- VirusTotal
- Suricata
- MongoDB
- Jenkins
- Pluggable Authentication Modules (PAM)
- Telnet
- SSH
- Solaris Basic Security module
- Asterisk
- Microsoft Windows DHCP
- Arpwatch
- Symantec
- Trend Micro OSCE (Office Scan)
- Horde IMP
- Roundcube
- Wordpress
- Compaq Insight Manager (cimserver)
- Dovecot
- Vm-pop3d
- FTP, Proftpd, PureFTP, Vsftpd, Microsoft FTP
- OwlH Zeek
- Junos
- Panda Advanced Protection Service (PAPS)
- CheckPoint Smart-1 Firewalls
- macOS SSH
- Google Cloud Pub/Sub



### Rule and Rootcheck example

Log analysis rule for Netscaler with PCI DSS compliance mapping:

```xml
<rule id="80102" level="10" frequency="6">
    <if_matched_sid>80101</if_matched_sid>
    <same_source_ip />
    <description>Netscaler: Multiple AAA failed to login the user</description>
    <group>authentication_failures,netscaler-aaa,pci_dss_10.2.4,pci_dss_10.2.5,pci_dss_11.4,</group>
</rule>
```

Rootcheck rule for SSH Server with mapping to CIS security benchmark and PCI DSS compliance:

```
[CIS - Debian Linux - 2.3 - SSH Configuration - Empty passwords permitted {CIS: 2.3 Debian Linux} {PCI_DSS: 4.1}] [any] [http://www.ossec.net/wiki/index.php/CIS_DebianLinux]
f:/etc/ssh/sshd_config -> !r:^# && r:^PermitEmptyPasswords\.+yes;
```



### Directory layout

The ruleset folder structure is shown below:

```
/var/ossec/
        ├─ etc/
        │   ├─ decoders/
        |   |        └─ local_decoder.xml
        │   └─ rules/
        |         └─ local_rules.xml
        └─ ruleset/
                ├─ decoders/
                └─ rules/
```

Custom rulesets in `etc/` folder, do not change common rulesets in `ruleset/` folder



## JSON decoder

Decode the log into JSON format, which can be Numbers, Strings, Booleans, Null values, Arrays, Objects

Extracted fields can be referred to by the rules.

### if_sid

```xml
...

<rule id="86600" level="0">
   <decoded_as>json</decoded_as>
   <field name="timestamp">\.+</field>
   <field name="event_type">\.+</field>
   <description>Suricata messages.</description>
</rule>

<rule id="86601" level="3">
   <if_sid>86600</if_sid>
   <field name="event_type">^alert$</field>
   <description>Suricata: Alert - $(alert.signature)</description>
</rule>

...
```

First alert by child rule id 86600, then alert by rule 86601 (**if_sid**)



### offset

Discarding some parts of the input string

For example, there is a part of JSON included as a part of an incoming log.

```
2018 Apr 04 13:11:52 nba_program: this_is_an_example: " player_information: "{ "name": "Stephen", "surname": "Curry", "team": "Golden State Warriors", "number": 30, "position": "point guard"}
```

```xml
<decoder name="raw_json">
    <program_name>nba_program</program_name>
    <prematch>player_information: "</prematch>
    <plugin_decoder offset="after_prematch">JSON_Decoder</plugin_decoder>
</decoder>
```

```
Type one log per line

2018 Apr 04 13:11:52 nba_program: this_is_an_example: " player_information: "{ "name": "Stephen", "surname": "Curry", "team": "Golden State Warriors", "number": 30, "position": "point guard"}

**Phase 1: Completed pre-decoding.
        full event: '2018 Apr 04 13:11:52 nba_program: this_is_an_example: " player_information: "{ "name": "Stephen", "surname": "Curry", "team": "Golden State Warriors", "number": 30, "position": "point guard"}'
        timestamp: '2018 Apr 04 13:11:52'
        program_name: 'nba_program'

**Phase 2: Completed decoding.
        name: 'raw_json'
        name: 'Stephen'
        number: '30'
        position: 'point guard'
        surname: 'Curry'
        team: 'Golden State Warriors'
```

The JSON decoder is not affected by any more data after a valid JSON object, and the JSON is extracted as dynamic fields.

In addition, we could define a rule for these raw events decoded:

```xml
<group name="local,">
  <rule id="100002" level="5">
    <decoded_as>raw_json</decoded_as>
    <description>Raw JSON event</description>
  </rule>
</group>
```

Finally, the result retrieved by *wazuh-logtest* would be:

```
**Phase 3: Completed filtering (rules).
        id: '100002'
        level: '5'
        description: 'Raw JSON event'
        groups: '['local']'
        firedtimes: '1'
        mail: 'False'
**Alert to be generated.
```



### Children decoders

We can set several children decoders from a parent specifying a plugin decoder as before, and also another one including a regex expression. For example, the following ones:

```xml
<decoder name="json_parent">
    <program_name>nba_email_db</program_name>
</decoder>

<decoder name="json_child">
    <parent>json_parent</parent>
    <prematch>json_data: </prematch>
    <plugin_decoder offset="after_prematch">JSON_Decoder</plugin_decoder>
</decoder>

<decoder name="json_child">
    <parent>json_parent</parent>
    <regex>@(\S+)"</regex>
    <order>email_domain</order>
</decoder>
```



## Custom rules and decoders

> We will use `local_decoder.xml` and `local_rules.xml` to implement small changes. For larger scale changes/additions to the stock decoders and rules, we recommend you create a new decoder and/or rule file.

The `<id>` of custom rules will be in the range from **100000** to **120000**.



### Adding a custom rule

Example log:

```
Dec 25 20:45:02 MyHost example[12345]: User 'admin' logged from '192.168.1.100'
```

Add the new decoder to `/var/ossec/etc/decoders/local_decoder.xml`:

```xml
<decoder name="example">
  <program_name>^example</program_name>
</decoder>

<decoder name="example">
  <parent>example</parent>
  <regex>User '(\w+)' logged from '(\d+.\d+.\d+.\d+)'</regex>
  <order>user, srcip</order>
</decoder>
```

Add the following rule to `/var/ossec/etc/rules/local_rules.xml`:

```xml
<rule id="100010" level="0">
  <program_name>example</program_name>
  <description>User logged</description>
</rule>
```

We can check if it works by using `/var/ossec/bin/wazuh-logtest`:

```
Type one log per line

Dec 25 20:45:02 MyHost example[12345]: User 'admin' logged from '192.168.1.100'

**Phase 1: Completed pre-decoding.
        full event: 'Dec 25 20:45:02 MyHost example[12345]: User 'admin' logged from '192.168.1.100''
        timestamp: 'Dec 25 20:45:02'
        hostname: 'MyHost'
        program_name: 'example'

**Phase 2: Completed decoding.
        name: 'example'
        dstuser: 'admin'
        srcip: '192.168.1.100'

**Phase 3: Completed filtering (rules).
        id: '100010'
        level: '0'
        description: 'User logged'
        groups: '['local', 'syslog', 'sshd']'
        firedtimes: '1'
        mail: 'False'
```



### Modifying existing decoder and rule

Please refers to https://documentation.wazuh.com/current/user-manual/ruleset/custom.html



## Dynamic fields

### Traditional decoder

OSSEC has provided thirteen predefined fields for storing extracted information (*user, srcip, dstip, srcport, dstport, protocol, action, id, url, data, extra_data, status, system_name*), of which only eight can be extracted simultaneously.

Static fields:

```xml
<decoder name="web-accesslog">
  <type>web-log</type>
  <prematch>^\d+.\d+.\d+.\d+ - </prematch>
  <regex>^(\d+.\d+.\d+.\d+) - \S+ [\S+ -\d+] </regex>
  <regex>"\w+ (\S+) HTTP\S+ (\d+) </regex>
  <order>srcip,url,id</order>
</decoder>
```



### Dynamic decoders

It is often necessary to extract **more than eight** relevant fields from an event,  and often the actual data items extracted have *no relationship to the limited list of predefined field names*. Wazuh has extended OSSEC to allow the decoding of an **unlimited number of fields** with *field names that clearly relate to what is being extracted*. Even **nested field** names are supported.

Dynamic fields:

```xml
<decoder name="auditd-config_change">
  <parent>auditd</parent>
  <regex offset="after_regex">^auid=(\S+) ses=(\S+) op="(\.+)"</regex>
  <order>audit.auid,audit.session,audit.op</order>
</decoder>
```

Wazuh transforms any field name included in the `<order>` tag into a JSON field.

> By default, the number of fields that can be extracted simultaneously from an `<order>` tag is **64**. This value can be modified by changing the variable `analysisd.decoder_order_size` seen in `/var/ossec/etc/internal_options.conf`. If you need to change this value, copy the `analysisd.decoder_order_size` section from `/var/ossec/etc/internal_options.conf` to `/var/ossec/etc/local_internal_options.conf` and change it there, since Wazuh software updates can replace `/var/ossec/etc/internal_options.conf`



## Decoder syntax

There are many options to configure in decoders:

| Option                                                       | Values                                                       | Description                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| [decoder](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#decoder) | Name of the decoder                                          | This attribute defines the decoder.                          |
| [parent](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#parent) | Any decoder's name                                           | It will reference a parent decoder and the current one will become a child decoder. |
| [accumulate](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#accumulate) | None                                                         | It allows tracking events over multiple log messages.        |
| [program_name](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#program-name) | Any [regex](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html#regex-os-regex-syntax), [sregex](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html#sregex-os-match-syntax) or [pcre2](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html#pcre2-syntax) expression. | It defines the name of the program associated with the decoder. |
| [prematch](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#prematch) | Any [regex](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html#regex-os-regex-syntax) or [pcre2](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html#pcre2-syntax) expression. | It will look for a match in the log. In case it does, the decoder will be used. |
| [regex](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#regex-decoders) | Any [regex](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html#regex-os-regex-syntax) or [pcre2](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html#pcre2-syntax) expression. | The decoder will use this option to find fields of interest and extract them. |
| [order](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#order) | See [order table](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#order) | The values that [regex](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#regex-decoders) will extract will be stored in these groups. |
| [fts](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#fts) | See [fts table](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#fts) | First time seen.                                             |
| [ftscomment](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#ftscomment) | Any String                                                   | Adds a comment to fts.                                       |
| [plugin_decoder](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#plugin-decoder) | See [below](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#plugin-decoder) | Specifies a plugin that will do the decoding. Useful when extraction with regex is not feasible. |
| [use_own_name](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#use-own-name) | True                                                         | Only for child decoders.                                     |
| [json_null_field](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#json-null-field) | String                                                       | Adds the option of deciding how a null value from a JSON will be stored. |
| [json_array_structure](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#json-array-structure) | String                                                       | Adds the option of deciding how an array structure from a JSON will be stored. |
| [var](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#var) | Name for the variable.                                       | Defines variables that can be reused inside the same file.   |
| [type](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#type) | See [type table](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#type) | It will set the type of log that the decoder is going to match. |



### How it works

Example

```
Apr 14 19:28:21 gorilla sshd[31274]: Connection closed by 192.168.1.33
```

Output

```
Type one log per line

Apr 14 19:28:21 gorilla sshd[31274]: Connection closed by 192.168.1.33

**Phase 1: Completed pre-decoding.
        full event: 'Apr 14 19:28:21 gorilla sshd[31274]: Connection closed by 192.168.1.33'
        timestamp: 'Apr 14 19:28:21'
        hostname: 'gorilla'
        program_name: 'sshd'

**Phase 2: Completed decoding.
        name: 'sshd'
        parent: 'sshd'
        srcip: '192.168.1.33'
```

The log firstly goes through a pre-decoding phase, where general information will be extracted if possible.

Afterward, the decoder will begin extracting information from the log that is left. In this example, the decoder only analyzes: `Connection closed by 192.168.1.33`.



### decoder

The attributes listed below define a decoder.

Set name of decoder to *ossec*:

```xml
<decoder name="ossec">
  ...
</decoder>
```



### parent

It is used to link a subordinate decoder to its parent. A parent decoder can have many child decoders but take into account that a child decoder cannot be a parent. It is possible to create what we call [sibling decoders](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/sibling-decoders.html), which is a handy decoding strategy to handle dynamic logs.

```xml
<decoder name="decoder_junior">
  <parent>decoder_father</parent>
  ...
</decoder>
```



### accumulate

Allows Wazuh to track events over multiple log messages based on a decoded id.

> Requires a regex populating the id field.



### program_name

It defines the name of the program which **the decoder is associated with**. The program name of a log will be obtained, if possible, in the **pre-decoding phase**.

```xml
<decoder name="test_decoder">
  <program_name type="pcre2">(?i)test</program_name>
</decoder>
```

`type` regex type

`(?i)test` pcre2 expression



### prematch

Find a match within the log for the string defined; **if it finds a match, the current decoder will be used.**

**Allowed values**: 

regex or pcre2 expression

**Attribute**: 

`offset` allows discarding some of the content of the entry, **"after_regex", "after_parent", "after_prematch"**

`type` allows to set regular expression type, **"osregex" or "pcre2"**



### regex

regex pattern, decoder will only extract those **fields** that are contained within **parentheses**

**When using the `regex` label, it is mandatory to define an `order` label as well

**Besides, `regex` label requires a `prematch` / `program_name` label defined on the same decoder, or a `parent` with a `prematch` / `program_name defined` label defined on it.

```xml
<decoder name="sudo-fields">
  <parent>sudo</parent>
  <prematch>\s</prematch>
  <regex>^\s*(\S+)\s*:</regex>
  <order>srcuser</order>
  <fts>name,srcuser,location</fts>
  <ftscomment>First time user executed the sudo command</ftscomment>
</decoder>
```

`(\S+)` defines the field `srcuser`



### order

It requires a `regex` label defined on the same decoder.

**Static fields**:

| srcuser     | Extracts the source username                          |
| ----------- | ----------------------------------------------------- |
| dstuser     | Extracts the destination (target) username            |
| user        | An alias to dstuser (only one of the two can be used) |
| srcip       | Source IP address                                     |
| dstip       | Destination IP address                                |
| srcport     | Source port                                           |
| dstport     | Destination port                                      |
| protocol    | Protocol                                              |
| system_name | System name                                           |
| id          | Event id                                              |
| url         | Url of the event                                      |
| action      | Event action (deny, drop, accept, etc.)               |
| status      | Event status (success, failure, etc.)                 |
| data        | Data                                                  |
| extra_data  | Any extra data                                        |

**Dynamic fields**: Any string not included in the previous list



### fts

Alert the attribute when first time the decoder was used.

| **Allowed values** | Explaination                                          |
| ------------------ | ----------------------------------------------------- |
| location           | Where does the log come from                          |
| srcuser            | Extracts the source username                          |
| dstuser            | Extracts the destination (target) username            |
| user               | An alias to dstuser (only one of the two can be used) |
| srcip              | Source IP address                                     |
| dstip              | Destination IP address                                |
| srcport            | Source port                                           |
| dstport            | Destination port                                      |
| protocol           | Protocol                                              |
| system_name        | System name                                           |
| id                 | Event id                                              |
| url                | Url of the event                                      |
| action             | Event action (deny, drop, accept, etc.)               |
| status             | Event status (success, failure, etc.)                 |
| data               | Data                                                  |
| extra_data         | Any extra data                                        |

The following decoder will extract the user who generated the alert and the location from where it comes:

```xml
<decoder name="fts-decoder">
  <fts>srcuser, location</fts>
  ...
</decoder>
```



### ftscomment

It adds a comment to a decoder when *\<fts>* tag is used.



### plugin_decoder

Use a specific plugin decoder to decode the incoming fields. It is useful for particular cases where it would be tricky to extract the fields by using regexes.

**Allowed values**: PF_Decoder, SymantecWS_Decoder, SonicWall_Decoder, OSSECAlert_Decoder, JSON_Decoder



### var

Defines a variable that may be used in any place of the same file.

```xml
<var name="header">myprog</var>
<var name="offset">after_parent</var>
<var name="type">syscall</var>

<decoder name="syscall">
  <prematch>^$header</prematch>
</decoder>

  <decoder name="syscall-child">
    <parent>syscall</parent>
    <prematch offset="$offset">^: $type </prematch>
    <regex offset="after_prematch">(\S+)</regex>
    <order>syscall</order>
  </decoder>
```



### type

It sets the type of log that the decoder is going to match.

**Allowed values**: firewall, ids, web-log, syslog, squid, windows, host-information, ossec



## Rules Syntax

The **xml labels** used to configure `rules` are listed here.

| Option                                                       | Values                                                       | Description                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| [rule](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#rule) | See [table](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#rule) below. | Its starts a new rule and its defining options.              |
| [match](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#match) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will attempt to find a match in the log using [sregex](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html#sregex-os-match-syntax) by default, deciding if the rule should be triggered. |
| [regex](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#regex-rules) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It does the same as `match`, but with [regex](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html#regex-os-regex-syntax) as default. |
| [decoded_as](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#decoded-as) | Any decoder's name.                                          | It will match with logs that have been decoded by a specific decoder. |
| [category](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#category) | Any [type](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#type). | It will match with logs whose decoder's [type](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#type) concur. |
| [field](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#field) | Name and any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a field extracted by the decoder in [order](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#order) with a regular expression. |
| [srcip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#srcip) | Any IP address.                                              | It will compare the IP address with the IP decoded as `srcip`. Use "!" to negate it. |
| [dstip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#dstip) | Any IP address.                                              | It will compare the IP address with the IP decoded as `dstip`. Use "!" to negate it. |
| [srcport](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#srcport) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a port with a value decoded as `srcport`. |
| [dstport](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#dstport) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a port with a value decoded as `dstport`. |
| [data](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#data) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a data with a value decoded as `data`. |
| [extra_data](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#extra-data) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing an extra data with a value decoded as `extra_data`. |
| [user](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#user) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a user with a value decoded as `user`. |
| [system_name](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#system-name) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a system name with a value decoded as `system_name`. |
| [program_name](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#program-name) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a program name with a value pre-decoded as `program_name`. |
| [protocol](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#protocol) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a protocol with a value decoded as `protocol`. |
| [hostname](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#hostname) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a hostname with a value pre-decoded as `hostname`. |
| [time](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#time) | Any time range. e.g. (hh:mm-hh:mm)                           | It checks if the event was generated during that time range. |
| [weekday](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#weekday) | monday - sunday, weekdays, weekends                          | It checks whether the event was generated during certain weekdays. |
| [id](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#id) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing an ID with a value decoded as `id` |
| [url](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#url) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a URL with a value decoded as `url` |
| [location](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#location) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a location with a value pre-decoded as `location`. |
| [action](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#action) | Any String or [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a string or regular expression representing an action with a value decoded as `action`. |
| [status](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#status) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a status with a value decoded as `status`. |
| [srcgeoip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#srcgeoip) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a GeoIP source with a value decoded as `srcgeoip`. |
| [dstgeoip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#dstgeoip) | Any [regular expression](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/regex.html). | It will compare a regular expression representing a GeoIP destination with a value decoded as `dstgeoip`. |
| [if_sid](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#if-sid) | A list of rule IDs separated by commas or spaces.            | It works similar to parent decoder. It will match when a rule ID on the list has previously matched. |
| [if_group](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#if-group) | Any group name.                                              | It will match if the indicated group has matched before.     |
| [if_level](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#if-level) | Any level from 1 to 16.                                      | It will match if that level has already been triggered by another rule. |
| [if_matched_sid](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#if-matched-sid) | Any rule ID (Number).                                        | Similar to `if_sid` but it will only match if the ID has been triggered in a period of time. |
| [if_matched_group](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#if-matched-group) | Any group name.                                              | Similar to `if_group` but it will only match if the group has been triggered in a period of time. |
| [same_id](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-id) | None.                                                        | The decoded `id` must be the same.                           |
| [different_id](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-id) | None.                                                        | The decoded `id` must be different.                          |
| [same_srcip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-srcip) | None.                                                        | The decoded `srcip` must be the same.                        |
| [different_srcip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-srcip) | None.                                                        | The decoded `srcip` must be different.                       |
| [same_dstip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-dstip) | None.                                                        | The decoded `dstip` must be the same.                        |
| [different_dstip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-dstip) | None.                                                        | The decoded `dstip` must be different.                       |
| [same_srcport](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-srcport) | None.                                                        | The decoded `srcport` must be the same.                      |
| [different_srcport](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-srcport) | None.                                                        | The decoded `srcport` must be different.                     |
| [same_dstport](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-dstport) | None.                                                        | The decoded `dstport` must be the same.                      |
| [different_dstport](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-dstport) | None.                                                        | The decoded `dstport` must be different.                     |
| [same_location](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-location) | None.                                                        | The `location` must be the same.                             |
| [different_location](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-location) | None.                                                        | The `location` must be different.                            |
| [same_srcuser](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-srcuser) | None.                                                        | The decoded `srcuser` must be the same.                      |
| [different_srcuser](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-srcuser) | None.                                                        | The decoded `srcuser` must be different.                     |
| [same_user](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-user) | None.                                                        | The decoded `user` must be the same.                         |
| [different_user](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-user) | None.                                                        | The decoded `user` must be different.                        |
| [same_field](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-field) | None.                                                        | The decoded `field` must be the same as the previous ones.   |
| [different_field](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-field) | None.                                                        | The decoded `field` must be different than the previous ones. |
| [same_protocol](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-protocol) | None.                                                        | The decoded `protocol` must be the same.                     |
| [different_protocol](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-protocol) | None.                                                        | The decoded `protocol` must be different.                    |
| [same_action](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-action) | None.                                                        | The decoded `action` must be the same.                       |
| [different_action](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-action) | None.                                                        | The decoded `action` must be different.                      |
| [same_data](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-data) | None.                                                        | The decoded `data` must be the same.                         |
| [different_data](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-data) | None.                                                        | The decoded `data` must be different.                        |
| [same_extra_data](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-extra-data) | None.                                                        | The decoded `extra_data` must be the same.                   |
| [different_extra_data](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-extra-data) | None.                                                        | The decoded `extra_data` must be different.                  |
| [same_status](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-status) | None.                                                        | The decoded `status` must be the same.                       |
| [different_status](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-status) | None.                                                        | The decoded `status` must be different.                      |
| [same_system_name](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-system-name) | None.                                                        | The decoded `system_name` must be the same.                  |
| [different_system_name](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-system-name) | None.                                                        | The decoded `system_name` must be different.                 |
| [same_url](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-url) | None.                                                        | The decoded `url` must be the same.                          |
| [different_url](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-url) | None.                                                        | The decoded `url` must be different.                         |
| [same_srcgeoip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-srcgeoip) | None.                                                        | The decoded `srcgeoip` must the same.                        |
| [different_srcgeoip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-srcgeoip) | None.                                                        | The decoded `srcgeoip` must be different.                    |
| [same_dstgeoip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#same-dstgeoip) | None.                                                        | The decoded `dstgeoip` must the same.                        |
| [different_dstgeoip](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#different-dstgeoip) | None.                                                        | The decoded `dstgeoip` must be different.                    |
| [description](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#description) | Any String.                                                  | Provides a human-readable description to explain what is the purpose of the rule. Please, use this field when creating custom rules. |
| [list](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#list) | Path to the CDB file.                                        | Perform a CDB lookup using an ossec list.                    |
| [info](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#info) | Any String.                                                  | Extra information using certain attributes.                  |
| [options](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#options) | See the table [below.](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#options) | Additional rule options that can be used.                    |
| [check_diff](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#check-diff) | None.                                                        | Determines when the output of a command changes.             |
| [group](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#group) | Any String.                                                  | Add additional groups to the alert.                          |
| [mitre](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#mitre) | See [Mitre table](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#mitre) below. | Contains Mitre Technique IDs that fit the rule               |
| [var](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#var) | Name for the variable. Most used: [BAD_WORDS](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/rules.html#bad-words) | Defines a variable that can be used anywhere inside the same file. |



### rule

The label that starts the block that defines a *rule*

The rule is created with ID: `3151` and it will trigger a level 10 alert if the rule `3102` has matched 8 times in the last 120 seconds

```xml
<rule id="3151" level="10" frequency="8" timeframe="120">
  <if_matched_sid>3102</if_matched_sid>
  <same_source_ip />
  <description>sendmail: Sender domain has bogus MX record. </description>
  <description>It should not be sending e-mail.</description>
  <mitre>
    <id>T1114</id>
    <id>T1499</id>
  </mitre>
  <group>multiple_spam,pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
</rule>
```

`level` level of the rule *(0 to 16)*

`id` id of the rule *(1 to 999999)*

`maxsize` maximum size of the event *(1 to 9999)*

`frequency` number of times the rule must have matched before firing *(2 to 9999)*

`timeframe` timeframe in seconds, to be used with the frequency option *(1 to 99999)*

`ignore` the time (in seconds) to ignore this rule after firing it to avoid floods *(1 to 999999)*

`overwrite` for the purpose of modifying existing rule *(yes, no)*

`noalert` not trigger an alert if the rule matches *(0, 1)* `0` (alerts, value by default) or `1` (no alerts). If `noalert` is set to `1`, the event continues analyzing other rules despite the rule matches



### match

**Allowed values**: Any regex, sregex or pcre2 expression

```xml
<rule id="100001" maxsize="300" level="3">
  <if_sid>100200</if_sid>
  <match>Queue flood!</match>
  <description>Flooded events queue.</description>
</rule>
```

If the rule matches the `id` 100200 and the log contains the `Queue flood!` phrase in it, rule activates and triggers a level 3 alert.



### regex

**Allowed values**: Any regex, sregex or pcre2 expression

```xml
<rule id="100001" level="3">
  <if_sid>100500</if_sid>
  <regex>\d+.\d+.\d+.\d+</regex>
  <description>Matches any valid IP</description>
</rule>
```

If the rule matches the `ìd` 100500 and the event contains any valid IP, the rule is triggered and generates a level 3 alert.



### decoded_as

**Allowed values**: Any decoder name

```xml
<rule id="53500" level="0">
  <decoded_as>smtpd</decoded_as>
  <description>OpenSMTPd grouping.</description>
</rule>
```

The rule will be triggered if the event was decoded by the `smtpd` decoder. Now is possible to make more rules that will inherit from this one, specifically made for OpenSMTPd events.



### category

**Allowed values**: Any type

```xml
<rule id="01" level="0" noalert="1">
  <category>syslog</category>
  <description>Generic template for all syslog rules.</description>
</rule>
```

The rule will be triggered if the event has previously been cataloged `syslog` by the decoder, but it will not trigger an alert. Instead, it will be matched by other rules that might trigger alerts if needed.



### field

**Allowed values**: Any regex, sregex or pcre2 expression

`name` field name extracted by decoder

```xml
<rule id="87100" level="0">
    <decoded_as>json</decoded_as>
    <field name="integration">virustotal</field>
    <description>VirusTotal integration messages.</description>
    <options>no_full_log</options>
</rule>
```

This rule, groups events decoded from json that belong to an integration called [VirusTotal](https://documentation.wazuh.com/current/user-manual/capabilities/virustotal-scan/index.html). It checks the field decoded as `integration` and if its content is `virustotal` the rule is triggered.



### srcip

**Allowed values**: Any srcip

```xml
<rule id="100105" level="8">
    <if_sid>100100</if_sid>
    <srcip>10.25.23.12</srcip>
    <description>Forbidden srcip has been detected.</description>
</rule>
```

This rule will trigger when that exact `scrip` has been decoded.



### dstip

**Allowed values**: Any dstip

```xml
<rule id="100110" level="5">
    <if_sid>100100</if_sid>
    <dstip>!198.168.41.30</dstip>
    <description>A different dstip has been detected.</description>
</rule>
```

This rule will trigger when an `dstip` different from `198.168.41.30` is detected.



### srcport

**Allowed values**: Any regex, sregex or pcre2 expression

```xml
<rule id="100110" level="5">
    <if_sid>100100</if_sid>
    <srcport type="pcre2">^5000[0-7]$</srcport>
    <description>Source port $(srcport) is detected.</description>
</rule>
```

This rule will trigger when `srcport` is in the range of 50000 to 50007.



### dstport

**Allowed values**: Any regex, sregex or pcre2 expression

It will check the destination port (decoded as `dstport`).



### data

**Allowed values**: Any regex, sregex or pcre2 expression

It will check the destination port (decoded as `data`).



### extra_data

**Allowed values**: Any regex, sregex or pcre2 expression

It will check the destination port (decoded as `extra_data`).

```xml
<rule id="7301" level="0">
  <category>windows</category>
  <extra_data>^Symantec AntiVirus</extra_data>
  <description>Grouping of Symantec AV rules from eventlog.</description>
</rule>
```

This rule will trigger when the log belongs to `windows` category and the decoded field `extra_data` is: `Symantec AntiVirus`



### user

**Allowed values**: Any regex, sregex or pcre2 expression

It will check the destination port (decoded as `user`).

```xml
<rule id="140101" level="12">
  <if_group>authentication_success</if_group>
  <user negate="yes">wazuh|root</user>
  <description>Unexpected user successfully logged to the system.</description>
</rule>
```

This rule will trigger when a user different from `root` or `wazuh` successfully login into the system.



### system_name

**Allowed values**: Any regex, sregex or pcre2 expression

It will check the destination port (decoded as `system_name`).



### program_name

**Allowed values**: Any regex, sregex or pcre2 expression

It will check the program's name which is decoded from syslog process name.

```xml
<rule id="1005" level="5">
  <program_name>syslogd</program_name>
  <match>^restart</match>
  <description>Syslogd restarted.</description>
  <group>pci_dss_10.6.1,gpg13_10.1,gpg13_4.14,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,</group>
</rule>
```

The rule will trigger when the program Syslogd restarted.



### protocol

**Allowed values**: Any regex, sregex or pcre2 expression

It will check the destination port (decoded as `protocol`).



### hostname

**Allowed values**: Any regex, sregex or pcre2 expression

Any hostname (decoded as the syslog hostname) or log file.

```xml
<rule id="2931" level="0">
  <hostname>yum.log$</hostname>
  <match>^Installed|^Updated|^Erased</match>
  <description>Yum logs.</description>
</rule>
```

This rule will group rules for `Yum logs` when something is either being installed, updated or erased.



### time

**Allowed values**: Any time range (hh:mm-hh:mm, hh:mm am-hh:mm pm, hh-hh, hh am-hh pm)

```xml
<rule id="17101" level="9">
  <if_group>authentication_success</if_group>
  <time>6 pm - 8:30 am</time>
  <description>Successful login during non-business hours.</description> 	<group>login_time,pci_dss_10.2.5,pci_dss_10.6.1,gpg13_7.1,gpg13_7.2,gdpr_IV_35.7.d,gdpr_IV_32.2,hipaa_164.312.b,nist_800_53_AU.14,nist_800_53_AC.7,nist_800_53_AU.6,</group>
</rule>
```

This rule will trigger when there is a successful login between 6 pm and 8 am.



### weekday

**Allowed values**: monday - sunday, weekdays, weekends

Checks the weekday that the event was generated.

```xml
<rule id="17102" level="9">
  <if_group>authentication_success</if_group>
  <weekday>weekends</weekday>
  <description>Successful login during weekend.</description>
<group>login_day,pci_dss_10.2.5,pci_dss_10.6.1,gpg13_7.1,gpg13_7.2,gdpr_IV_35.7.d,gdpr_IV_32.2,hipaa_164.312.b,nist_800_53_AU.14,nist_800_53_AC.7,nist_800_53_AU.6,</group>
</rule>
```

This rule will trigger when there is a successful login during the weekend.



### id

**Allowed values**: Any regex, sregex or pcre2 expression

It will check any ID (decoded as the `ID`).

```xml
<rule id="81100" level="0">
    <decoded_as>kernel</decoded_as>
    <id>usb</id>
    <description>USB messages grouped.</description>
</rule>
```

This rule will group the logs whose decoded ID is usb.



### url

**Allowed values**: Any regex, sregex or pcre2 expression

It will check any URL (decoded as the `URL`).

```xml
<rule id="31102" level="0">
  <if_sid>31101</if_sid>
  <url>.jpg$|.gif$|favicon.ico$|.png$|robots.txt$|.css$|.js$|.jpeg$</url>
  <compiled_rule>is_simple_http_request</compiled_rule>
  <description>Ignored extensions on 400 error codes.</description>
</rule>
```

This rule is a child from a level 5 rule `31101` and becomes a level 0 rule when it confirms that the extensions are nothing to worry about.



### location

**Allowed values**: Any regex, sregex or pcre2 expression

It will check the content of the field location and trying to find a match.

The location identifies the origin of the input. If the event comes from an agent, its name and registered IP address (as it was added) is appended to the location.

Format of a location for a log pulled from "/var/log/syslog" in an agent with name "dbserver" and registered with IP "any":

```
(dbserver) any->/var/log/syslog
```

| **Component**        | **Location**           |
| -------------------- | ---------------------- |
| Windows Eventchannel | EventChannel           |
| Windows Eventlog     | WinEvtLog              |
| FIM (Syscheck)       | syscheck               |
| Rootcheck            | rootcheck              |
| Syscollector         | syscollector           |
| Vuln Detector        | vulnerability-detector |
| Azure Logs           | azure-logs             |
| AWS S3 integration   | aws-s3                 |
| Docker integration   | Wazuh-Docker           |
| Osquery integration  | osquery                |
| OpenSCAP integration | open-scap              |
| CIS-CAT integration  | wodle_cis-cat          |
| SCA module           | sca                    |

```xml
<rule id="24000" level="3">
  <location>osquery$</location>
  <description>osquery message</description>
</rule>
```

This rule, groups logs that come from `osquery` location. Triggering a level 3 alert for it.



### action

**Allowed values**: Any regex, sregex or pcre2 expression

It will check any action (decoded as the `action`).

```xml
<rule id="4502" level="4">
  <if_sid>4500</if_sid>
  <action type="osregex">warning|WARN</action>
  <description>Netscreen warning message.</description>
</rule>
```

This rule will trigger a level 4 alert when the decoded action from Netscreen is `warning` or `WARN`.



### status

**Allowed values**: Any regex, sregex or pcre2 expression

Checks the actual status of an event.

```xml
<rule id="213" level="7">
  <if_sid>210</if_sid>
  <status>aborted</status>
  <description>Remote upgrade could not be launched. Error: $(error).</description>
  <group>upgrade,upgrade_failure,</group>
</rule>
```



### srcgeoip

**Allowed values**: Any regex, sregex or pcre2 expression

It will check the GeoIP source (decoded as `srcgeoip`).



### dstgeoip

**Allowed values**: Any regex, sregex or pcre2 expression

It will check the GeoIP destination (decoded as `dstgeoip`).



### if_sid

**Allowed values**: Any rule ID. Multiple values must be separated by commas or spaces.

Matches when an ID on the list has previously matched. It is similar to a child decoder, with the key difference that alerts can have as many descendants as necessary, whereas decoder cannot have "grandchildren".

```xml
<rule id="100110" level="5">
  <if_sid>100100, 100101</if_sid>
  <match>Error</match>
  <description>There is an error in the log.</description>
</rule>
```

The rule `100110` is triggered when either of the parent rules has matched and the logs contain the word "Error".



### if_group

**Allowed values**: Any Group

Matches if the group has matched before.

```xml
<rule id="184676" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="sysmon.image">lsm.exe</field>
    <description>Sysmon - Suspicious Process - lsm.exe</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,nist_800_53_SI.4,</group>
</rule>
```

The rule matches if the group `sysmon_event1` has previously matched before and if the field decoded as `sysmon.image` is "lsm.exe".



### if_level

**Allowed values**: Any level from 1 to 16

Matches if the level has matched before.



### if_matched_sid

**Allowed values**: Any rule id

Matches if an alert of the defined ID has been triggered in a set number of seconds.

This option is used in conjunction with `frequency` and `timeframe`.

```xml
<rule id="30316" level="10" frequency="10" timeframe="120">
  <if_matched_sid>30315</if_matched_sid>
  <same_source_ip />
  <description>Apache: Multiple Invalid URI requests from same source.</description>
  <mitre>
    <id>T1499</id>
  </mitre>
  <group>gdpr_IV_35.7.d,hipaa_164.312.b,invalid_request,nist_800_53_AU.14,nist_800_53_AC.7,nist_800_53_SI.4,pci_dss_10.2.4,pci_dss_11.4,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
</rule>
```

The rule is triggered when rule 30315 has been triggered 10 times in 120 seconds and if the requests were made by the same `srcip`.



### if_matched_group

**Allowed values**: Any group

Matches if an alert of the defined group has been triggered in a set number of seconds.

This option is used in conjunction with `frequency` and `timeframe`.

```xml
<rule id="40113" level="12" frequency="8" timeframe="360">
  <if_matched_group>virus</if_matched_group>
  <description>Multiple viruses detected - Possible outbreak.</description>
  <group>virus,pci_dss_5.1,pci_dss_5.2,pci_dss_11.4,gpg13_4.2,gdpr_IV_35.7.d,nist_800_53_SI.3,nist_800_53_SI.4,</group>
</rule>
```

The rule will trigger when the group `virus` has been matched 8 times in the last 360 seconds.



### if_fts

Makes the decoder that processed the event to take the [fts](https://documentation.wazuh.com/current/user-manual/ruleset/ruleset-xml-syntax/decoders.html#fts) line into consideration.



### same_id, different_id, same_srcip,  different_srcip, same_dstip, different_dstip, same_srcport, different_srcport, same_dstport, same_location, different_location, same_srcuser, different_srcuser, same_user, different_user, ...

These options are used in conjunction with `frequency` and `timeframe`.



### same_field (, different_field)

The value of the dynamic field specified in this option must appear in previous events a `frequency` number of times within the required `timeframe`.

```xml
<!-- {"key":"value", "key2":"AAAA"} -->
<rule id="100001" level="3">
  <decoded_as>json</decoded_as>
  <field name="key">value</field>
  <description>Testing JSON alert</description>
</rule>

<rule id="100002" level="10" frequency="4" timeframe="300">
  <if_matched_sid>100001</if_matched_sid>
  <same_field>key2</same_field>
  <description>Testing same_field option</description>
</rule>
```

Rule 100002 will fire when `key2` in the currently considered event is the same in four events that matched rule 100001 before within the last 300 seconds. Therefore, for the following events sequence:

```json
{"key":"value", "key2":"AAAA"}
{"key":"value", "key2":"AAAA"}
{"key":"value", "key2":"BBBB"}
{"key":"value", "key2":"AAAA"}
{"key":"value", "key2":"CCCC"}
{"key":"value", "key2":"CCCC"}
{"key":"value", "key2":"AAAA"} // alert Rule 100002
```



### description

Specifies a human-readable description to the rule in order to provide context to each alert regarding the nature of the events matched by it.

Since Wazuh version 3.3 it is possible to include any decoded field (static or dynamic) to the description message. You can use the following syntax: `$(field_name)` to add a field to the description.

```xml
<rule id="100005" level="8">
  <match>illegal user|invalid user</match>
  <description>sshd: Attempt to login using a non-existent user from IP $(attempt_ip)</description>
  <options>no_log</options>
</rule>
```



### list

Perform a CDB lookup using an ossec list. This is a fast on-disk database which will always find keys within two seeks of the file.

```xml
<rule id="80780" level="3">
    <if_sid>80700</if_sid>
    <list field="audit.key" lookup="match_key_value" check_value="write">etc/lists/audit-keys</list>
    <description>Audit: Watch - Write access</description>
    <group>audit_watch_write,gdpr_IV_30.1.g,</group>
</rule>
```

The rule will look for "audit.key" in the CDB list. Where it will check if its equal to "write", in which case it will match and trigger a level 3 alert.



### info

Extra information may be added through the following attributes:

text, link, cve, ovsdb

```xml
<rule id="5714" level="14" timeframe="120" frequency="3">
  <if_matched_sid>5713</if_matched_sid>
  <match>Local: crc32 compensation attack</match>
  <description>sshd: SSH CRC-32 Compensation attack</description>
  <info type="cve">2001-0144</info>
  <info type="link">http://www.securityfocus.com/bid/2347/info/</info>
  <group>exploit_attempt,pci_dss_11.4,pci_dss_6.2,gpg13_4.12,gdpr_IV_35.7.d,nist_800_53_SI.4,nist_800_53_SI.2,</group>
</rule>
```

The rule provides additional information about the threat it detects.



### options

Additional rule options.

| Attribute          | Description                                       |
| ------------------ | ------------------------------------------------- |
| **alert_by_email** | Always alert by email.                            |
| **no_email_alert** | Never alert by email.                             |
| **no_log**         | Do not log this alert.                            |
| **no_full_log**    | Do not include the `full_log` field in the alert. |
| **no_counter**     | Omit field `rule.firedtimes` in the JSON alert.   |

```xml
<rule id="9800" level="8">
  <match>illegal user|invalid user</match>
  <description>sshd: Attempt to login using a non-existent user</description>
  <options>no_log</options>
</rule>
```



### check_diff

For example: Used to determine when the output ('w') of a command changes.

```xml
<rule id="534" level="1">
  <if_sid>530</if_sid>
  <match>ossec: output: 'w'</match>
  <check_diff />
  <options>no_log</options>
  <description>List of logged in users. It will not be alerted by default.</description>
</rule>
```



### group

Add additional groups to the alert. Groups are *optional tags* added to alerts.

They can be used by other rules by using `if_group` or `if_matched_group`, or by alert parsing tools to categorize alerts.

```xml
<rule id="3801" level="4">
  <description>Group for rules related with spam.</description>
  <group>spam,</group>
</rule>
```



### mitre

Specifies the [MITRE ATT&CK](https://attack.mitre.org/) technique ID or IDs that fit in well with the rule.

```xml
<rule id="100002" level="10">
  <description>Attack technique sample.</description>
  <mitre>
    <id>T1110</id>
    <id>T1037</id>
  </mitre>
</rule>
```



### var

Defines a variable that may be used in any place of the same file.

```xml
<var name="joe_folder">/home/joe/</var>

  <group name="local,">

    <rule id="100001" level="5">
      <if_sid>550</if_sid>
      <field name="file">^$joe_folder</field>
      <description>A Joe's file was modified.</description>
      <group>ossec,pci_dss_10.6.1,gpg13_10.1,gdpr_IV_35.7.d,</group>
    </rule>

</group>
```



### BAD_WORDS

\<var name="BAD_WORDS">error|warning|failure\</var>

`BAD_WORDS` is a very used use case of the `<var>` option.

It is used to include many words in the same variable. Later, this variable can be matched into the decoders to check if any of those words are in a caught event.

```xml
<var name="BAD_WORDS">error|warning|failure</var>

<group name="syslog,errors,">
  <rule id="XXXX" level="2">
    <match>$BAD_WORDS</match>
    <description>Error found.</description>
  </rule>
</group>
```



## Regular Expression Syntax

There are three types of regular expressions: regex (*OS_Regex*), sregex (*OS_Match*) and PCRE2.

**Supported expressions**

| Expressions | Valid characters                        |
| ----------- | --------------------------------------- |
| \w          | A-Z, a-z, 0-9, '-', '@', '_' characters |
| \d          | 0-9 character                           |
| \s          | Spaces " "                              |
| \t          | Tabs                                    |
| \p          | ()*+,-.:;<=>?[]!"'#$%&\|{}              |
| \W          | Anything not \w                         |
| \D          | Anything not \d                         |
| \S          | Anything not \s                         |
| \\.         | Anything                                |

**Modifiers**

| Expressions | Actions                     |
| ----------- | --------------------------- |
| +           | To match one or more times  |
| *           | To match zero or more times |

**Special characters**

| Expressions | Actions                                          |
| ----------- | ------------------------------------------------ |
| ^           | To specify the beginning of the text             |
| $           | To specify the end of the text                   |
| \|          | To create a logical or between multiple patterns |

**Characters escaping**

To utilize the following characters they must be escaped with: \

| $    | (    | )    | \    | \|   | <    |
| ---- | ---- | ---- | ---- | ---- | ---- |
| \$   | \(   | \)   | \\\\ | \|   | \<   |



## Using CDB Lists

Wazuh is able to check if a field extracted during the decoding phase is in a CDB list (constant database). The main use case of this feature is to create a white/black list of users, file hashes, IP addresses, or domain names.

https://documentation.wazuh.com/current/user-manual/ruleset/cdb-list.html

### Creating the list file

The list file is a plain text file where each line has the following format:

```
key1:value1
key2:value2
```

### CDB lists examples

```xml
<rule id="110700" level="10">
  <if_group>json</if_group>
  <list field="srcip" lookup="address_match_key">etc/lists/List-one</list>
  <description>IP blacklisted in LIST ONE</description>
  <group>list1,</group>
</rule>


<rule id="110701" level="10">
  <if_group>json</if_group>
  <list field="srcip" lookup="address_match_key">etc/lists/List-two</list>
  <description>IP blacklisted in LIST TWO</description>
  <group>list2,</group>
</rule>


<rule id="110710" level="10">
  <if_sid>110700</if_sid>
  <list field="srcip" lookup="address_match_key">etc/lists/List-two</list>
  <description>IP blacklisted in LIST ONE and LIST TWO</description>
  <group>list1,list2,</group>
</rule>
```

